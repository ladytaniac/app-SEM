import { Component } from '@angular/core';
import { IonicPage, NavController, NavParams } from 'ionic-angular';

import { ZebraPrinter, Printer, PrinterStatus } from 'ca-cleversolutions-zebraprinter/native';
import { ActionSheetController } from 'ionic-angular';

/**
 * Generated class for the ImpresionPage page.
 *
 * See https://ionicframework.com/docs/components/#navigation for more info on
 * Ionic pages and navigation.
 */

@IonicPage()
@Component({
  selector: 'page-impresion',
  templateUrl: 'impresion.html',
})
export class ImpresionPage {
  estadoPrint: PrinterStatus;
  dispositivos: Printer[];
  address: any;
  name: any;

  constructor(
    public navCtrl: NavController, 
    public navParams: NavParams,
    protected zebraPrinter: ZebraPrinter,
    public actionCtrl: ActionSheetController,
  ) {
    this.discover();
  }
  
  ionViewDidLoad() {
    console.log('ionViewDidLoad ImpresionPage');
  }

  discover() {
    this.zebraPrinter.discover().then(result => {
      this.address = result[0].address;
      this.name = result[0].name;
      console.log(result);
    }).catch(err => {
      console.log(err);

    });
  }

  conectingToPrinter() {
    this.zebraPrinter.connect(this.address).then(result => {
      console.log("connceting:" + result);
    }).catch(err => {
      console.log(err);

    })
  }

  printMulta() {
    console.log('estoy aca');
    this.zebraPrinter.printerStatus().then((result) => {
      console.log("estado de conexión: ", result);
      this.estadoPrint = <PrinterStatus>result;
      console.log("conectado?: ", this.estadoPrint.connected);
      if (this.estadoPrint.connected) {
        console.log("permiso para imprimir");
      } else {
        this.seleccionarImpresora();
      }
    }).catch(error => {
      console.error("falló: ", error);
    })
  }

  seleccionarImpresora() {
		this.zebraPrinter.discover().then(result => {
			this.dispositivos = <Printer[]>result;
			this.mostrarDispositivos();
		}).catch(err => {
			console.error(err);
		});
	}

  mostrarDispositivos() {
		const actionSheet = this.actionCtrl.create({
			title: "Seleccione la impresora",
			buttons: [
				// {
				//   text: "impresora 1",
				//   handler: ()=>{
				//     console.log("se escogio impresora 1");
				//   }
				// },{
				//   text: "impresora 2",
				//   handler:()=>{
				//     console.log("impresora 2 seleccionada");
				//   }
				// },{
				//   text: "Cancelar",
				//   role: 'cancel'
				// }
			]
		});
		this.dispositivos.forEach(item => {
			console.log(item.name);
			actionSheet.addButton(
				{ text: item.name, handler: () => { this.conectar(item.address) } }
			);
			actionSheet.addButton({ text: "Cancelar", role: 'cancel' });
		});
		actionSheet.present();
	}
	protected conectar(address) {
		// this.zebraPrinter.connect('AC:3F:A4:55:F0:3C').then(result => {
		this.zebraPrinter.connect(address).then(result => {
			console.log("conectado: ", result);
      var numBoleta = '000018';
      var fecha = '2021-12-14';
      var costo = '2.00';
      var codReser = 'BE7';
      var hraReser = '10:01 - 11:01';
      var nameFunc = 'GUSTAVO ADALID ORTIZ MERUVIA';
      var placa = '877HGV';


      let receipt = '';
      receipt += '^XA';
      receipt += '^FX Top section with logo, name and address.';
      receipt += '^CF0,60';
      receipt += '^FO20,50^GFA,12978,12978,63,,::::::j03E,iY01FFC,iY07IF,iY0JF8,iX01JFC,iX03JFE,:iX07KF,:W07IFChV0LF,V0LFEhU0LF8,U0NFEhT0LF8,T07OFChS0LF8,S03QFhS0LF8,S0RFChR0LF8,R03SFhR0LF8,R0TFChQ0LF8,Q01UFhQ0LF8,Q07UF8hP0LF8,Q0VFEhP0LF8,P03WFhP0LF8,P07WF8hO0LF8,P0XFChO0LF8,O03YFhO0LF8,O07YF8hN0LF8,O0gFChN0LF8,N01gFEhN0LF8,N03gGFhN0LF8,N07gGFhN0LF8,N07gGF8hM0LF8,N0gHFChM0LF8,M01gHFEhM0LF8,M03gIFhM0LF8,M07gIFhM0LF8,M07PF001PF8hL0LF8,M0PFJ01OF8hL0LF8,L01OF8K03NFChL0LF8,L01NFCM0NFEhL0LF8,L03NF8M03MFEP01FF8Y01FF8O0LF803FEY07FE,L03MFEN01NFO03JFEW07JFEN0LF8KF8U01KF8,L07MFCO07MFN03LFCU03LFCM0SFU0MF,L07MFP03MFN0NF8S01NF8L0SFCS07MFE,L0MFEP01MF8L03NFES07NFEL0TFR01OF8,L0MFCQ0MF8L0PF8Q01PF8K0TFCQ07OFE,K01MF8Q07LF8K03PFEQ03PFEK0UFQ0QF8,K01MFR03LF8K0RFQ0RFK0UF8O03QFC,K03LFER01LF8J01RFCO01RFCJ0UFEO07RF,K03LFER01LFK03RFEO07RFEJ0VFN01SF8,K03LFCS0LFK0TFO0TFJ0VF8M03SFC,K07LF8S07KFJ01TF8M01TF8I0VFCM07SFE,K07LF8S03JFEJ03TFCM03TFCI0VFEM0UF,K07LFT03JFCJ07TFEM07TFEI0WFL01UF8,K07KFET01JFCJ0VFM0VFI0WF8K03UFC,K0LFEU0JF8I01VF8K01VF800WF8K07UFE,K0LFEU07FFEJ01VFCK03VFC00WFCK0WF,K0LFCU01FF8J03VFEK07VFE00WFEK0WF8,K0LFCV03CK07VFEK07VFE00WFEJ01WF8,J01LF8gI0XFK0XF00XFJ03WFC,J01LF8gI0XF8I01XF80XF8I07WFE,J01LF8gH01XF8I01XF80XF8I07WFE,J01LF8gH01XFCI03XFC0XFCI0YF,J01LFgI03XFCI03XFC0XFCI0YF8,J01LFgI03XFEI07XFE0XFC001YF8,J01LFgI07NF007MFEI07NF00NFE0OF03MFE001OF0OFC,J01LFgI07MF8I0NFI0NF8001MFE0NF8007LFE003NFI07MFC,J03LFgI0MFEJ03MFI0MFEJ07LFE0MFEI03MF003MFCI01MFC,J03LFgI0MF8J01MF801MF8J01LFE0MFCJ0MF003MFK0MFE,J03LFgI0MFL0MF801MFL0LFE0MF8J07LF007LFEK03LFE,J03LFgH01LFEL07LF801LFEL07KFE0MFK03LF007LFCK01MF,J01LFgH01LFCL03LFC03LFCL03KFE0LFEK03LF807LF8L0MF,J01LFgH01LFCL01LFC03LF8L01KFC0LFCK01LF80MFM07LF,J01LFgH03LF8M0LFC03LF8L01KFC0LFCK01LF80LFEM07LF,J01LFgH03LFN0LFC03LFN0KF80LFCL0LF80LFCM03LF,J01LF8gG03LFN07KFE03KFEN07JF80LF8L0LF80LFCM03LF8,J01LF8gG03KFEN07KFE07KFEN03JF00LF8L0LF81LF8M01LF8,J01LF8gG03KFEN03KFE07KFEN01IFE00LF8L0LF81LF8M01LF8,J01LF8gG03KFEN03KFE07KFCO0IFC00LF8L0LF81LF8N0LF8,K0LFCgG03KFEN03KFE07KFCO03FFI0LF8L0LF81LFO0LF8,K0LFCgG07KFCN03KFE07KFCU0LF8L0LF81LFO0LF8,K0LFCU01FCI07KFCN03KFE07KFCU0LF8L0LF81LFO0LF8,K0LFEU07FF8007KFCN03KFE07KFCU0LF8L0LF81LFO0LF8,K07KFET01IFC007KFCN01KFE07KFCU0LF8L0LF81LFO0LF8,K07LFT03IFE007KFCN03KFE07KFCU0LF8L0LF81LFO0LF8,K07LFT07JF007KFCN03KFE07KFCU0LF8L0LF81LFO0LF8,K07LF8S07JF807KFCN03KFE07KFCU0LF8L0LF81LFO0LF8,K03LFCS0KFC03KFEN03KFE07KFCU0LF8L0LF81LFO0LF8,K03LFCR01KFE03KFEN03KFE07KFCO03FCI0LF8L0LF81LF8N0LF8,K03LFER01KFE03KFEN03KFE07KFEO0IF800LF8L0LF81LF8M01LF8,K01MFR03KFE03KFEN07KFE07KFEN03IFC00LF8L0LF81LF8M01LF8,K01MF8Q07LF03LFN07KFE03LFN07IFE00LF8L0LF80LFCM03LF8,L0MFCQ0MF03LFN0LFC03LFN0KF00LF8L0LF80LFCM03LF8,L0MFEP01MF03LF8M0LFC03LF8L01KF80LF8L0LF80LFEM07LF8,L07MFP07MF01LFCL01LFC03LF8L01KF80LF8L0LF80MFM07LF8,L07MFCO0NF01LFCL03LFC01LFCL03KFC0LF8L0LF807LF8L0MF8,L03MFEN01MFE01LFEL07LF801LFEL07KFC0LF8L0LF807LFCK01MF8,L03NF8M07MFE00MFL0MF801MFL0LFC0LF8L0LF807LFEK03MF8,L01NFEL01NFE00MFCJ01MF800MFCJ01LFC0LF8L0LF803MFK0NF8,M0OF8K07NFC00MFEJ03MFI0MFEJ07LFC0LF8L0LF803MFCI01NF8,M0PF8I07OF8007MF8I0NFI0NF8001MFC0LF8L0LF803NFI0OF8,M07PFC0QF8007NF007MFEI07NF00NFC0LF8L0LF801OF0PF8,M03gIFI03XFEI07XFC0LF8L0LF801gF8,M03gHFEI03XFCI03XFC0LF8L0LF800gF8,M01gHFCI01XFCI03XFC0LF8L0LF800gF8,N0gHFCI01XF8I01XF80LF8L0LF8007YF8,N07gGF8J0XF8I01XF80LF8L0LF8007YF8,N03gGFK07WFK0XF00LF8L0LF8003YF8,N01gFEK07VFEK07VFE00LF8L0LF8001YF8,O0gFCK03VFEK03VFE00LF8L0LF8I0YF8,O07YF8K01VFCK03VFC00LF8L0LF8I0YF8,O03YFM0VF8K01VF800LF8L0LF8I07XF8,O01XFEM0VFM0VFI0LF8L0LF8I03XF8,P0XFCM07TFEM07TFEI0LF8L0LF8I01XF8,P07WFN03TFCM03TFCI0LF8L0LF8J0XF8,P03VFEN01TF8M01TF8I0LF8L0LF8J07WF8,Q0VFCO07SFO0TFJ0LF8L07KF8J03WF8,Q03UFP03RFEO07RFEJ0LFM07KF8J01WF8,Q01TFEP01RFCO01RFCJ07KFM07KFL07VF8,R07SF8Q07QFQ0RFK07KFM03KFL03VF,R01RFER03PFEQ03PFEK03JFEM03KFM0VF,S07QF8S0PF8Q01PF8K03JFEM01JFEM03TFE,S01PFET03NFES07NFEL01JFCM01JFCN0OF8JFC,T03OFV0NF8T0NFN0JF8N0JF8N03MFE07IF8,U07MF8V01LFCU03LFCN07IFO03IFP07LF003IF,V07KF8X03JFCW03JFCO01FFCO01FFCQ0KFJ0FFE,X07FCgH0FFgG0FFR03EQ01ES03FCK01E,,:::::::::iG01EhH03CK0C,iG01FhH07CJ03C,iG03FhH07CJ0FC,iG01FhH07CI01F,iH0EhH038I07C,kP07,kP0E,,gJ01S0CI03,gI03FFI01FFC003C7FC03FEJ0FFCI07FEJ01E0381FC00383F8J0FF001EI03C00FE07I03F8003C001FCI0F07F,gI07FFC003IF003DIF0IF8003IFI0IF8I01E03C7FF0078FFEI03FFC01EI07C03FF87801IF003C007FF800F1FFC,gI0IFE00JF803JF9IFC007IF801IFCI01E038IF8079IFI0JF01FI0780IFC7003IF803C01IFC00F3FFE,gH01F03E01F80FC03F80F9E07E00FC0FC03E07CI01E039E1FC079C3F801FE7F80FI0F81FF7E7007F3FC03C03FCFF00F787F,gH01E01F01F007E03F007F803E01F003E03C03EI01E03B807C07B00FC03F00F80FI0F01F80F700FC07E03C07E01F00FE01F,gH01E00F03E001E03E003F001F01E001F07C01EI01E03E003E07E003C03E007C07800F03E003F01F001E03C07800F80FC00F8,gH01E00F03C001F03E003FI0F03EI0F07C01EI01E03E003E07C003E07C003E07801F07C001F01E001F03C0F8007C0F80078,gH01EJ078I0F03C001EI0F03CI0F83CL01E03C001E07C001E078001E07C01E07C001F03EI0F03C0FI03C0FI078,gH01FJ078I0F03C001EI0F07CI0783EL01E03C001E07C001E0F8001E03C01E078I0F03CI0F03C1EI03C0FI078,gI0FCI078I0F83C001EI0F078I0783F8K01E03C001E078001E0FJ0F03C03C078I0F03CK03C1EI03C0FI03C,gI0FF80078I0783C001EI0F078I0781FFK01E038001E078001E0FJ0F01E03C0F8I0703CK03C1EI01E0FI03C,gI03FF0078I0783C001EI0F078I07807FEJ01E038001E078001E0FJ0F01E07C0FJ0703CK03C1EI01E0FI03C,gJ0FFC078I0783C001EI0F078I07801FF8I01E03C001E078001E0FJ0F01F0780FJ0703CK03C1EI01E0FI03C,gK0FE078I0783C001EI0F078I078003FCI01E03C001E078001E0FJ0F00F0780F8I0703CK03C1EI01E0FI03C,gK01F078I0F03C001EI0F078I078I07EI01E03C001E078001E0FJ0F00F0F0078I0F03CK03C1EI03E0FI03C,gL0F078I0F03C001EI0F03CI0F8I01EI01E03C001E078001E0FI01F0078F0078I0F03CI0703C1EI03C0FI03C,gL0787C001F03C001EI0F03CI0FK0FI01E03C001E078001E078001E0078F0078I0F03CI0F03C1FI03C0FI03C,gH03C00783C001E03C001EI0F03E001F07800FI01E03C001E078001E078003E0079E007C001F01EI0F03C0FI07C0FI03C,gH03E00F83E003E03C001EI0F01F003E07C01EI01E03C001E078001E07C003C003DE003E003F01F001F03C0F800780FI03C,gH01F01F01F80FC03C001EI0F00F807E03E03EI01E03C001E078001E03E00FC003FC003F007700F803E03C07C01F80FI03C,gI0FC7F00FF7F803C001EI0F00FF3FC03F8FCI01E03C001E078001E01F81F8003FC001FC1E700FE0FC03C03F07F00FI03C,gI0IFE007IF003C001EI0F007IF801IFCI01E03C001E078001E00JFI01FCI0IFE7007IF803C01IFE00FI03C,gI03FFC003FFE003C001EI0F001FFEI07FF8I01E03C001E078001E007FFEI01F8I07FF87801IF003C00IFC00FI03C,gJ0FFJ07FI03C001EI0FI07F8I01FCJ01E03C001E078001E001FF8J0F8I01FF07I0FFC003C003FFI0FI03C,j03CQ078K01FN078,,:::::::::::::::::::::::::::::^FS';
      receipt += '^FO50,250^GB700,3,3^FS';
      receipt += '^FX Second section with recipient address and permit information.';
      receipt += '^CFA,30';
      receipt += '^FO140,270^FDComprobante S.E.M^FS';
      receipt += '^FO20,340^FDNro. Boleta: ' + numBoleta + '^FS';
      receipt += '^FO02,380^FH_^FD_ Fecha Impresi_A2n: ' + fecha + '^FS';
      receipt += '^FO20,420^FDPlaca: ' + placa + '^FS';
      receipt += '^FO20,460^FDCosto de Reserva: ' + costo + ' Bs. ^FS';
      receipt += '^FO20,500^FDCod Reserva: ' + codReser + '^FS';
      receipt += '^FO20,540^FDHora Reserva: ' + hraReser + '^FS';
      receipt += '^FO20,590^GB700,3,3^FS';
      receipt += '^FO20,610^FDFuncionario:^FS';
      receipt += '^FO20,640^FD' + nameFunc + '^FS';
      receipt += '^XZ';

      this.zebraPrinter.print(receipt).then(result => {
        console.log("impresion: ", result);
      });
		}).catch(error => {
			console.error("falló: ", error);
		})
	}

}
